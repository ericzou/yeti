<%= render :partial => 'lists/list_actions' %>

<%= render :partial => 'lists/list_meta' %>

<div id="trash-can" style=""></div>    

<ul class="list-items">
  <%= render :partial => @list.list_items %>  
</ul>

<div id="new-list-item-wrapper">
  <%  form_for [@list, @list_item] do |f| %>
  <%= f.text_field :body, :class => "form-textfield minimal-matching-height long"  %>
  <button class="minimal">Add Item</button>
  <% end %>
</div>

<script type="text/javascript">
  $(document).ready(function(){
  
    $('.list-items').sortable({
      cursor : 'move', 
      stop : function(event, ui){
        $.ajax({
          url: "<%= sort_list_list_items_path(@list) %>",
          type: "put", 
          dataType: "html",
          data: $(this).sortable('serialize'),
          success: function(data){
            $(".list-items").html(data);
          }
        });
      }
    });
    
    $('#trash-can').droppable({
      tolerance: "pointer",
      activate: function(){
        $('#trash-can').remove("over");
        $('#trash-can').addClass("activated");
      },
      over: function(){
        $('#trash-can').removeClass("activated");
        $('#trash-can').addClass("over");
      },
      out: function(){
        $('#trash-can').addClass("activated");
        $('#trash-can').removeClass("over");
      },
      deactivate: function(){
        $('#trash-can').removeClass("activated");
        $('#trash-can').removeClass("over");
      },
      drop: function(event, ui){
        $(ui.draggable).remove();
        var list_item_id = $(ui.draggable).attr("id").replace(/list_item_/, "");
        $.ajax({
          url: "/lists/" + <%= @list.id %> + "/list_items/" + list_item_id,
          type: "delete", 
          dataType: "html",
          data: { id : list_item_id},
          success: function(data){
            $(".list-items").html(data);
          }
        });
      }
    });
    
    $('form#new_list_item').submit(function(e){
      e.preventDefault();
      if ($('#list_item_body').val() === ''){
        return false;
      }
      $.ajax({
        url : $(this).attr("action"),
        type: "post",
        dateType: "html",
        data: { list_item : { body : $('#list_item_body').val() }},
        success : function(data){
          $(".list-items").append(data);
          $('#list_item_body').val('').focus();
        }
      });
    });
  });
</script>